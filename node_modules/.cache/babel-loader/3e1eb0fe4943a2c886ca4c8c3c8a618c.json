{"ast":null,"code":"// 异步发送ajax请求的模块\n// 封装axios库\nimport axios from \"axios\";\nimport { message } from \"antd\";\nimport storageUtils from \"../utils/storageUtils\";\nimport { pathIsDev } from '../common/methods';\nconst isAdmin = pathIsDev(); // 请求拦截\n\naxios.interceptors.request.use(function (config) {\n  if (isAdmin) {\n    if (storageUtils.getAdminToken()) {\n      config.headers.Auth = storageUtils.getAdminToken();\n    }\n  } else {\n    if (storageUtils.getUserToken()) {\n      config.headers.Auth = storageUtils.getUserToken();\n    }\n  }\n\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n}); // 响应拦截\n\naxios.interceptors.response.use(response => {\n  console.log(response);\n\n  if (response.data.code === 101) {\n    if (isAdmin) {\n      window.location.href = '/dev/login';\n      return Promise.reject(response);\n    } else {\n      window.location.href = '/dev/login';\n      return Promise.reject(response);\n    }\n  }\n\n  return response;\n}, error => {\n  return Promise.reject(error);\n});\nexport default async function ajax(url, data = {}, type = 'GET') {\n  try {\n    return new Promise(resolve => {\n      let promise; // 1.执行ajax请求\n\n      if (type === 'GET') {\n        promise = axios.get(url, {\n          params: data\n        });\n      } else {\n        promise = axios.post(url, data);\n      } // 2.如果成功了，调用resolve(value)\n\n\n      promise.then(response => {\n        resolve(response.data);\n      });\n    });\n  } catch (error) {\n    // 3.如果失败了，不调用reject(reason),提示异常信息\n    message.error('请求出错了：', error.message);\n  }\n}","map":{"version":3,"sources":["E:/React/workspace/order-ticket/src/api/ajax.js"],"names":["axios","message","storageUtils","pathIsDev","isAdmin","interceptors","request","use","config","getAdminToken","headers","Auth","getUserToken","error","Promise","reject","response","console","log","data","code","window","location","href","ajax","url","type","resolve","promise","get","params","post","then"],"mappings":"AAAA;AACA;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,OAAT,QAAwB,MAAxB;AACA,OAAOC,YAAP,MAAyB,uBAAzB;AACA,SAASC,SAAT,QAA0B,mBAA1B;AACA,MAAMC,OAAO,GAAGD,SAAS,EAAzB,C,CAEA;;AACAH,KAAK,CAACK,YAAN,CAAmBC,OAAnB,CAA2BC,GAA3B,CAA+B,UAAUC,MAAV,EAAkB;AAC7C,MAAIJ,OAAJ,EAAa;AACT,QAAIF,YAAY,CAACO,aAAb,EAAJ,EAAkC;AAC9BD,MAAAA,MAAM,CAACE,OAAP,CAAeC,IAAf,GAAsBT,YAAY,CAACO,aAAb,EAAtB;AACH;AACJ,GAJD,MAIO;AACH,QAAIP,YAAY,CAACU,YAAb,EAAJ,EAAiC;AAC7BJ,MAAAA,MAAM,CAACE,OAAP,CAAeC,IAAf,GAAsBT,YAAY,CAACU,YAAb,EAAtB;AACH;AACJ;;AACD,SAAOJ,MAAP;AACH,CAXD,EAWG,UAAUK,KAAV,EAAiB;AAChB,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH,CAbD,E,CAeA;;AACAb,KAAK,CAACK,YAAN,CAAmBW,QAAnB,CAA4BT,GAA5B,CAAgCS,QAAQ,IAAI;AACxCC,EAAAA,OAAO,CAACC,GAAR,CAAYF,QAAZ;;AACA,MAAIA,QAAQ,CAACG,IAAT,CAAcC,IAAd,KAAuB,GAA3B,EAAgC;AAC5B,QAAIhB,OAAJ,EAAa;AACTiB,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,YAAvB;AACA,aAAOT,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAP;AACH,KAHD,MAGO;AACHK,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,YAAvB;AACA,aAAOT,OAAO,CAACC,MAAR,CAAeC,QAAf,CAAP;AACH;AACJ;;AACD,SAAOA,QAAP;AACH,CAZD,EAaIH,KAAK,IAAI;AACL,SAAOC,OAAO,CAACC,MAAR,CAAeF,KAAf,CAAP;AACH,CAfL;AAiBA,eAAe,eAAeW,IAAf,CAAoBC,GAApB,EAAyBN,IAAI,GAAG,EAAhC,EAAoCO,IAAI,GAAG,KAA3C,EAAkD;AAE7D,MAAI;AACA,WAAO,IAAIZ,OAAJ,CAAaa,OAAD,IAAa;AAC5B,UAAIC,OAAJ,CAD4B,CAE5B;;AACA,UAAIF,IAAI,KAAK,KAAb,EAAoB;AAChBE,QAAAA,OAAO,GAAG5B,KAAK,CAAC6B,GAAN,CAAUJ,GAAV,EAAe;AACrBK,UAAAA,MAAM,EAAEX;AADa,SAAf,CAAV;AAGH,OAJD,MAIO;AACHS,QAAAA,OAAO,GAAG5B,KAAK,CAAC+B,IAAN,CAAWN,GAAX,EAAgBN,IAAhB,CAAV;AACH,OAT2B,CAU5B;;;AACAS,MAAAA,OAAO,CAACI,IAAR,CAAahB,QAAQ,IAAI;AACrBW,QAAAA,OAAO,CAACX,QAAQ,CAACG,IAAV,CAAP;AACH,OAFD;AAIH,KAfM,CAAP;AAgBH,GAjBD,CAiBE,OAAON,KAAP,EAAc;AACZ;AACAZ,IAAAA,OAAO,CAACY,KAAR,CAAc,QAAd,EAAwBA,KAAK,CAACZ,OAA9B;AACH;AACJ","sourcesContent":["// 异步发送ajax请求的模块\r\n// 封装axios库\r\nimport axios from \"axios\"\r\nimport { message } from \"antd\"\r\nimport storageUtils from \"../utils/storageUtils\"\r\nimport { pathIsDev } from '../common/methods'\r\nconst isAdmin = pathIsDev()\r\n\r\n// 请求拦截\r\naxios.interceptors.request.use(function (config) {\r\n    if (isAdmin) {\r\n        if (storageUtils.getAdminToken()) {\r\n            config.headers.Auth = storageUtils.getAdminToken()\r\n        }\r\n    } else {\r\n        if (storageUtils.getUserToken()) {\r\n            config.headers.Auth = storageUtils.getUserToken()\r\n        }\r\n    }\r\n    return config\r\n}, function (error) {\r\n    return Promise.reject(error)\r\n})\r\n\r\n// 响应拦截\r\naxios.interceptors.response.use(response => {\r\n    console.log(response)\r\n    if (response.data.code === 101) {\r\n        if (isAdmin) {\r\n            window.location.href = '/dev/login'\r\n            return Promise.reject(response)\r\n        } else {\r\n            window.location.href = '/dev/login'\r\n            return Promise.reject(response)\r\n        }\r\n    }\r\n    return response\r\n},\r\n    error => {\r\n        return Promise.reject(error)\r\n    })\r\n\r\nexport default async function ajax(url, data = {}, type = 'GET') {\r\n\r\n    try {\r\n        return new Promise((resolve) => {\r\n            let promise\r\n            // 1.执行ajax请求\r\n            if (type === 'GET') {\r\n                promise = axios.get(url, {\r\n                    params: data\r\n                })\r\n            } else {\r\n                promise = axios.post(url, data)\r\n            }\r\n            // 2.如果成功了，调用resolve(value)\r\n            promise.then(response => {\r\n                resolve(response.data)\r\n            })\r\n\r\n        })\r\n    } catch (error) {\r\n        // 3.如果失败了，不调用reject(reason),提示异常信息\r\n        message.error('请求出错了：', error.message)\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}