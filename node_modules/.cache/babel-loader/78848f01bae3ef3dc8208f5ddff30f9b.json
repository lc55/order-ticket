{"ast":null,"code":"var _jsxFileName = \"E:\\\\React\\\\workspace\\\\order-ticket\\\\src\\\\pages\\\\Dev\\\\Trains\\\\Updata\\\\index.jsx\";\nimport React, { Component } from 'react';\nimport { Input, Card, Form, Button, Col, Row, Space, Select, TimePicker, message } from 'antd';\nimport moment from 'moment';\nimport SiteInfo from '../SiteInfo';\nimport CarriageInfo from '../CarriageInfo';\nimport MyNavLink from '../../../../components/MyNavLink';\nimport { updataTrain, getTrainInfo } from '../../../../api/dev/train';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Option\n} = Select;\nconst format = 'HH:mm';\nexport default class TrainUpdate extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      siteList: [],\n      carriageList: [],\n      carriages: [],\n      site: {},\n      isUpdata: 0\n    };\n\n    this.deleteCarriage = key => {\n      const carriages = [...this.state.carriages];\n      const newDataSource = carriages.filter(item => {\n        if (item.carriageOrder !== key) {\n          if (item.carriageOrder > key) {\n            --item.carriageOrder;\n          }\n\n          return item;\n        }\n      });\n      const carriageIdList = newDataSource.map(item => {\n        return item.carriageId;\n      });\n      this.setState({\n        carriageList: carriageIdList,\n        isUpdata: 1\n      });\n    };\n\n    this.deleteSite = number => {\n      const siteList = [...this.state.siteList];\n      const newDataSource = siteList.filter(item => {\n        if (item.number !== number) {\n          if (item.number > number) {\n            --item.number;\n          }\n\n          return item;\n        }\n      });\n      this.setState({\n        siteList: newDataSource,\n        isUpdata: 1\n      });\n    };\n\n    this.handleIsUpdata = () => {\n      this.setState({\n        isUpdata: 1\n      });\n    };\n\n    this.updataTrain = async values => {\n      const {\n        siteList,\n        carriageList,\n        isUpdata\n      } = this.state;\n\n      if (isUpdata === 1) {\n        const startTime = moment(values.startTime).format('HH:mm');\n        const train = { ...values,\n          startTime,\n          siteList,\n          carriageList\n        };\n        const result = await updataTrain(train);\n\n        if (result.code === 1) {\n          message.success('更新成功');\n          this.props.history.goBack();\n        } else {\n          message.error(result.msg);\n        }\n      }\n    };\n\n    this.addSite = site => {\n      const {\n        siteList\n      } = this.state;\n      const newSite = [...siteList, site];\n      this.setState({\n        siteList: newSite,\n        isUpdata: 1\n      });\n    };\n\n    this.addCarriage = carriage => {\n      const {\n        carriageList\n      } = this.state;\n      const newCarriage = [...carriageList, carriage];\n      this.setState({\n        carriageList: newCarriage,\n        isUpdata: 1\n      });\n    };\n  }\n\n  async componentWillMount() {\n    const {\n      id\n    } = this.props.match.params;\n    const result = await getTrainInfo(id);\n\n    if (result.code === 1) {\n      const {\n        carriageList\n      } = result.data;\n      const carriageIdList = carriageList.map((item, _) => {\n        return item.carriageId;\n      });\n      this.setState({\n        siteList: result.data.siteList,\n        carriages: result.data.carriageList,\n        site: result.data.baseInfo,\n        carriageList: carriageIdList\n      });\n    } else {\n      message.error(result.msg);\n    }\n  }\n\n  render() {\n    const {\n      siteList,\n      carriages,\n      site\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          title: /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontSize: '30px'\n            },\n            children: \"\\u7F16\\u8F91\\u8F66\\u6B21\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 32\n          }, this),\n          children: Object.keys(site).length ? /*#__PURE__*/_jsxDEV(Form, {\n            layout: \"vertical\",\n            onFinish: this.updataTrain,\n            onValuesChange: this.handleIsUpdata,\n            children: [/*#__PURE__*/_jsxDEV(Row, {\n              gutter: 16,\n              children: [/*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  name: \"trainNumber\",\n                  label: \"\\u8F66\\u6B21\",\n                  rules: [{\n                    required: true,\n                    message: '请输入车次'\n                  }],\n                  required: \"true\",\n                  initialValue: site.trainNumber,\n                  children: /*#__PURE__*/_jsxDEV(Input, {\n                    placeholder: \"\\u8BF7\\u8F93\\u5165\\u8F66\\u6B21\",\n                    readOnly: true\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 136,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 129,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 128,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  name: \"isReturn\",\n                  label: \"\\u8FD4\\u7A0B\\u8F66\",\n                  rules: [{\n                    required: true,\n                    message: '请选择是否返程'\n                  }],\n                  required: \"true\",\n                  initialValue: site.isReturn,\n                  children: /*#__PURE__*/_jsxDEV(Select, {\n                    placeholder: \"\\u662F\\u5426\\u8FD4\\u7A0B\",\n                    children: [/*#__PURE__*/_jsxDEV(Option, {\n                      value: 1,\n                      children: \"\\u662F\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 148,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(Option, {\n                      value: 0,\n                      children: \"\\u5426\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 149,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 147,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 140,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 139,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Row, {\n              gutter: 16,\n              children: [/*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  name: \"type\",\n                  label: \"\\u7C7B\\u522B\",\n                  rules: [{\n                    required: true,\n                    message: '请选择类别'\n                  }],\n                  required: \"true\",\n                  initialValue: site.type,\n                  children: /*#__PURE__*/_jsxDEV(Select, {\n                    placeholder: \"\\u7C7B\\u522B\",\n                    children: [/*#__PURE__*/_jsxDEV(Option, {\n                      value: 1,\n                      children: \"\\u52A8\\u8F66\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 164,\n                      columnNumber: 53\n                    }, this), /*#__PURE__*/_jsxDEV(Option, {\n                      value: 2,\n                      children: \"\\u9AD8\\u94C1\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 165,\n                      columnNumber: 53\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 163,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 156,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 155,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  name: \"startTime\",\n                  label: \"\\u53D1\\u8F66\\u65F6\\u95F4\",\n                  rules: [{\n                    required: true,\n                    message: '请选择发车时间'\n                  }],\n                  required: \"true\",\n                  initialValue: moment(site.startTime, format),\n                  children: /*#__PURE__*/_jsxDEV(TimePicker, {\n                    format: format\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 177,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 170,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 169,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 154,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Row, {\n              gutter: 16,\n              children: /*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  name: \"trainCount\",\n                  label: \"\\u73ED\\u8F66\\u6570\\u91CF\",\n                  rules: [{\n                    required: true,\n                    message: '请输入班车数量'\n                  }],\n                  initialValue: site.shift,\n                  children: /*#__PURE__*/_jsxDEV(Input, {\n                    placeholder: \"\\u8BF7\\u8F93\\u5165\\u73ED\\u8F66\\u6570\\u91CF\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 189,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 183,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Row, {\n              gutter: 16,\n              children: /*#__PURE__*/_jsxDEV(Col, {\n                span: 12,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  rules: [{\n                    required: true,\n                    message: '请输入站点信息'\n                  }],\n                  children: /*#__PURE__*/_jsxDEV(SiteInfo, {\n                    addSite: this.addSite,\n                    deleteSite: this.deleteSite,\n                    siteList: siteList\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 199,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 194,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Row, {\n              gutter: 16,\n              children: /*#__PURE__*/_jsxDEV(Col, {\n                span: 20,\n                children: /*#__PURE__*/_jsxDEV(Form.Item, {\n                  rules: [{\n                    required: true,\n                    message: '请输入车厢信息'\n                  }],\n                  children: /*#__PURE__*/_jsxDEV(CarriageInfo, {\n                    addCarriage: this.addCarriage,\n                    deleteCarriage: this.deleteCarriage,\n                    carriageList: carriages\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 208,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 205,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                textAlign: 'right',\n                marginTop: '50px'\n              },\n              children: /*#__PURE__*/_jsxDEV(Space, {\n                size: \"large\",\n                children: [/*#__PURE__*/_jsxDEV(MyNavLink, {\n                  to: \"/dev/trains\",\n                  children: /*#__PURE__*/_jsxDEV(Button, {\n                    style: {\n                      marginRight: 8\n                    },\n                    children: \"\\u53D6\\u6D88\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 220,\n                    columnNumber: 49\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 219,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  type: \"primary\",\n                  htmlType: \"submit\",\n                  children: \"\\u786E\\u8BA4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 224,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 122,\n            columnNumber: 33\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["E:/React/workspace/order-ticket/src/pages/Dev/Trains/Updata/index.jsx"],"names":["React","Component","Input","Card","Form","Button","Col","Row","Space","Select","TimePicker","message","moment","SiteInfo","CarriageInfo","MyNavLink","updataTrain","getTrainInfo","Option","format","TrainUpdate","state","siteList","carriageList","carriages","site","isUpdata","deleteCarriage","key","newDataSource","filter","item","carriageOrder","carriageIdList","map","carriageId","setState","deleteSite","number","handleIsUpdata","values","startTime","train","result","code","success","props","history","goBack","error","msg","addSite","newSite","addCarriage","carriage","newCarriage","componentWillMount","id","match","params","data","_","baseInfo","render","fontSize","Object","keys","length","required","trainNumber","isReturn","type","shift","textAlign","marginTop","marginRight"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport {\r\n    Input, Card,\r\n    Form, Button, Col, Row, Space, Select, TimePicker, message\r\n} from 'antd';\r\nimport moment from 'moment'\r\nimport SiteInfo from '../SiteInfo';\r\nimport CarriageInfo from '../CarriageInfo'\r\nimport MyNavLink from '../../../../components/MyNavLink'\r\nimport { updataTrain, getTrainInfo } from '../../../../api/dev/train';\r\n\r\nconst { Option } = Select\r\nconst format = 'HH:mm'\r\nexport default class TrainUpdate extends Component {\r\n\r\n    state = {\r\n        siteList: [],\r\n        carriageList: [],\r\n        carriages: [],\r\n        site: {},\r\n        isUpdata: 0,\r\n    }\r\n\r\n    deleteCarriage = (key) => {\r\n        const carriages = [...this.state.carriages];\r\n        const newDataSource = carriages.filter((item) => {\r\n            if (item.carriageOrder !== key) {\r\n                if (item.carriageOrder > key) {\r\n                    --item.carriageOrder\r\n                }\r\n                return item\r\n            }\r\n        })\r\n        const carriageIdList = newDataSource.map((item) => {\r\n            return item.carriageId\r\n        })\r\n        this.setState({\r\n            carriageList: carriageIdList,\r\n            isUpdata: 1,\r\n        });\r\n    }\r\n\r\n    deleteSite = (number) => {\r\n        const siteList = [...this.state.siteList];\r\n        const newDataSource = siteList.filter((item) => {\r\n            if (item.number !== number) {\r\n                if (item.number > number) {\r\n                    --item.number\r\n                }\r\n                return item\r\n            }\r\n        })\r\n        this.setState({\r\n            siteList: newDataSource,\r\n            isUpdata: 1,\r\n        });\r\n    }\r\n\r\n    // 判断是否修改过表单\r\n    handleIsUpdata = () => {\r\n        this.setState({ isUpdata: 1 })\r\n    }\r\n\r\n    // 更新车次\r\n    updataTrain = async (values) => {\r\n        const { siteList, carriageList, isUpdata } = this.state\r\n        if (isUpdata === 1) {\r\n            const startTime = moment(values.startTime).format('HH:mm')\r\n            const train = { ...values, startTime, siteList, carriageList }\r\n            const result = await updataTrain(train)\r\n            if (result.code === 1) {\r\n                message.success('更新成功')\r\n                this.props.history.goBack()\r\n            } else {\r\n                message.error(result.msg)\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    addSite = (site) => {\r\n        const { siteList } = this.state\r\n        const newSite = [...siteList, site]\r\n        this.setState({ siteList: newSite, isUpdata: 1, })\r\n    }\r\n\r\n    addCarriage = (carriage) => {\r\n        const { carriageList } = this.state\r\n        const newCarriage = [...carriageList, carriage]\r\n        this.setState({ carriageList: newCarriage, isUpdata: 1, })\r\n    }\r\n\r\n    async componentWillMount() {\r\n        const { id } = this.props.match.params\r\n        const result = await getTrainInfo(id)\r\n        if (result.code === 1) {\r\n            const { carriageList } = result.data\r\n            const carriageIdList = carriageList.map((item, _) => {\r\n                return item.carriageId\r\n            })\r\n            this.setState({\r\n                siteList: result.data.siteList,\r\n                carriages: result.data.carriageList,\r\n                site: result.data.baseInfo,\r\n                carriageList: carriageIdList\r\n            })\r\n        } else {\r\n            message.error(result.msg)\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { siteList, carriages, site } = this.state\r\n        return (\r\n            <div>\r\n                <div>\r\n                    <Card\r\n                        title={<span style={{ fontSize: '30px' }}>编辑车次</span>}\r\n                    >\r\n                        {\r\n                            Object.keys(site).length ?\r\n                                <Form\r\n                                    layout=\"vertical\"\r\n                                    onFinish={this.updataTrain}\r\n                                    onValuesChange={this.handleIsUpdata}\r\n                                >\r\n                                    <Row gutter={16}>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                name=\"trainNumber\"\r\n                                                label=\"车次\"\r\n                                                rules={[{ required: true, message: '请输入车次' }]}\r\n                                                required=\"true\"\r\n                                                initialValue={site.trainNumber}\r\n                                            >\r\n                                                <Input placeholder=\"请输入车次\" readOnly />\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                name=\"isReturn\"\r\n                                                label=\"返程车\"\r\n                                                rules={[{ required: true, message: '请选择是否返程' }]}\r\n                                                required=\"true\"\r\n                                                initialValue={site.isReturn}\r\n                                            >\r\n                                                <Select placeholder=\"是否返程\" >\r\n                                                    <Option value={1}>是</Option>\r\n                                                    <Option value={0}>否</Option>\r\n                                                </Select>\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <Row gutter={16}>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                name=\"type\"\r\n                                                label=\"类别\"\r\n                                                rules={[{ required: true, message: '请选择类别' }]}\r\n                                                required=\"true\"\r\n                                                initialValue={site.type}\r\n                                            >\r\n                                                <Select placeholder=\"类别\">\r\n                                                    <Option value={1}>动车</Option>\r\n                                                    <Option value={2}>高铁</Option>\r\n                                                </Select>\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                name=\"startTime\"\r\n                                                label=\"发车时间\"\r\n                                                rules={[{ required: true, message: '请选择发车时间' }]}\r\n                                                required=\"true\"\r\n                                                initialValue={moment(site.startTime, format)}\r\n                                            >\r\n                                                <TimePicker format={format} />\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <Row gutter={16}>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                name=\"trainCount\"\r\n                                                label=\"班车数量\"\r\n                                                rules={[{ required: true, message: '请输入班车数量' }]}\r\n                                                initialValue={site.shift}\r\n                                            >\r\n                                                <Input placeholder=\"请输入班车数量\" />\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <Row gutter={16}>\r\n                                        <Col span={12}>\r\n                                            <Form.Item\r\n                                                rules={[{ required: true, message: '请输入站点信息' }]}\r\n\r\n                                            >\r\n                                                <SiteInfo addSite={this.addSite} deleteSite={this.deleteSite} siteList={siteList} />\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <Row gutter={16}>\r\n                                        <Col span={20}>\r\n                                            <Form.Item\r\n                                                rules={[{ required: true, message: '请输入车厢信息' }]}\r\n                                            >\r\n                                                <CarriageInfo addCarriage={this.addCarriage} deleteCarriage={this.deleteCarriage} carriageList={carriages} />\r\n                                            </Form.Item>\r\n                                        </Col>\r\n                                    </Row>\r\n                                    <div\r\n                                        style={{\r\n                                            textAlign: 'right',\r\n                                            marginTop: '50px'\r\n                                        }}\r\n                                    >\r\n                                        <Space size=\"large\">\r\n                                            <MyNavLink to=\"/dev/trains\">\r\n                                                <Button style={{ marginRight: 8 }}>\r\n                                                    取消\r\n                                                </Button>\r\n                                            </MyNavLink>\r\n                                            <Button type=\"primary\" htmlType=\"submit\">\r\n                                                确认\r\n                                            </Button>\r\n                                        </Space>\r\n\r\n                                    </div>\r\n                                </Form> : null\r\n                        }\r\n                    </Card>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}